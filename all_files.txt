.\App.xamlï¼š
ã€ï»¿
<Application x:Class="WordPopupApp.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:WordPopupApp"
             StartupUri="MainWindow.xaml">
    <Application.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Application.Resources>
</Application>ã€‘

.\App.xaml.csï¼š
ã€ï»¿using System.Configuration;
using System.Data;
using System.Windows;

namespace WordPopupApp
{
    /// <summary>
    /// Interaction logic for App.xaml
    /// </summary>
    public partial class App : Application
    {
    }

}
ã€‘

.\AssemblyInfo.csï¼š
ã€using System.Windows;

[assembly: ThemeInfo(
    ResourceDictionaryLocation.None,            //where theme specific resource dictionaries are located
                                                //(used if a resource is not found in the page,
                                                // or application resource dictionaries)
    ResourceDictionaryLocation.SourceAssembly   //where the generic resource dictionary is located
                                                //(used if a resource is not found in the page,
                                                // app, or any theme specific resource dictionaries)
)]
ã€‘

.\MainWindow.xamlï¼š
ã€ï»¿<Window x:Class="WordPopupApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WordPopupApp"
        mc:Ignorable="d"
        Title="åˆ’è¯ç¿»è¯‘è®¾ç½® (å¿«æ·é”®: Ctrl+Z)" Height="300" Width="400"
        Loaded="Window_Loaded" Closing="Window_Closing"
        FontFamily="Microsoft YaHei UI">
    <Grid Margin="20">
        <StackPanel>
            <TextBlock Text="Anki è®¾ç½®" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>

            <TextBlock Text="ç›®æ ‡ç‰Œç»„ (Deck Name):"/>
            <TextBox x:Name="DeckNameTextBox" Margin="0,5,0,10" Text="Default"/>

            <TextBlock Text="ç¬”è®°ç±»å‹ (Note Type):"/>
            <TextBox x:Name="ModelNameTextBox" Margin="0,5,0,10" Text="Basic"/>

            <Button Content="ä¿å­˜è®¾ç½®" Click="SaveButton_Click" Width="100" HorizontalAlignment="Left" Margin="0,20,0,0"/>

            <TextBlock Text="ä½¿ç”¨è¯´æ˜ï¼šæœ€å°åŒ–æœ¬çª—å£åï¼Œåœ¨ä»»ä½•åœ°æ–¹é€‰ä¸­è‹±æ–‡å•è¯ï¼ŒæŒ‰ Ctrl + Q å³å¯æŸ¥è¯¢ã€‚"
                       TextWrapping="Wrap" Margin="0,40,0,0" Foreground="Gray"/>
        </StackPanel>
    </Grid>
</Window>ã€‘

.\MainWindow.xaml.csï¼š
ã€ï»¿using System;
using System.Threading.Tasks;
using System.Windows;
using WordPopupApp.Services;
using WordPopupApp.Models;
using WordPopupApp.ViewModels;
using WordPopupApp.Views;
using System.Windows.Interop;
using System.Windows.Input;

namespace WordPopupApp
{
    public partial class MainWindow : Window
    {
        private GlobalHotKey _hotKey;
        private readonly DictionaryService _dictionaryService;
        private readonly AnkiService _ankiService;
        private readonly SettingsService _settingsService;
        private AppSettings _currentSettings;

        public MainWindow()
        {
            InitializeComponent();
            _dictionaryService = new DictionaryService();
            _ankiService = new AnkiService();
            _settingsService = new SettingsService();
        }

        private void Window_Loaded(object sender, RoutedEventArgs e)
        {
            // åŠ è½½è®¾ç½®
            _currentSettings = _settingsService.LoadSettings();
            DeckNameTextBox.Text = _currentSettings.AnkiDeckName;
            ModelNameTextBox.Text = _currentSettings.AnkiModelName;

            // æ³¨å†Œå…¨å±€çƒ­é”® Ctrl + Z
            try
            {
                uint vk = (uint)KeyInterop.VirtualKeyFromKey(Key.Z);  // æŠŠ WPF çš„ Key è½¬æˆ VK
                _hotKey = new GlobalHotKey(this, HotKeyModifiers.MOD_CONTROL, vk);
                // Virtual-Key Codes: https://docs.microsoft.com/en-us/windows/win32/inputdev/virtual-key-codes
                _hotKey.HotKeyPressed += OnHotKeyPressed;
            }
            catch (Exception ex)
            {
                MessageBox.Show($"æ³¨å†Œçƒ­é”®å¤±è´¥: {ex.Message}");
            }
        }

        private async void OnHotKeyPressed()
        {
            // 1. æ¨¡æ‹ŸCtrl+Cå¤åˆ¶é€‰ä¸­å†…å®¹
            GlobalHotKey.SimulateCtrlC();

            // 2. ä»å‰ªè´´æ¿è·å–æ–‡æœ¬
            string selectedText = GlobalHotKey.GetTextFromClipboard()?.Trim();

            if (string.IsNullOrEmpty(selectedText))
            {
                return;
            }

            // 3. å¼‚æ­¥æŸ¥è¯¢
            var entry = await _dictionaryService.LookupAsync(selectedText);

            // 4. åˆ›å»ºViewModelå’ŒView
            var viewModel = new PopupResultViewModel(entry, _ankiService, _currentSettings);
            var popup = new PopupResultWindow
            {
                DataContext = viewModel
            };

            // 5. åœ¨é¼ æ ‡æ—æ˜¾ç¤ºçª—å£
            popup.SetPositionAndShow();
        }

        private void SaveButton_Click(object sender, RoutedEventArgs e)
        {
            _currentSettings.AnkiDeckName = DeckNameTextBox.Text;
            _currentSettings.AnkiModelName = ModelNameTextBox.Text;
            _settingsService.SaveSettings(_currentSettings);
            MessageBox.Show("è®¾ç½®å·²ä¿å­˜ï¼");
        }

        private void Window_Closing(object sender, System.ComponentModel.CancelEventArgs e)
        {
            _hotKey?.Dispose();
        }
    }
}ã€‘

.\mergy.pyï¼š
ã€import os

# æ’é™¤çš„æ–‡ä»¶å¤¹åï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰
exclude_folders = {'bin', '.vs', 'obj'}

# è¾“å‡ºæ–‡ä»¶å
output_file = 'all_files.txt'

with open(output_file, 'w', encoding='utf-8') as outfile:
    for root, dirs, files in os.walk('.'):
        # ä¿®æ”¹dirså¯ä»¥è·³è¿‡ä¸æƒ³éå†çš„æ–‡ä»¶å¤¹
        dirs[:] = [d for d in dirs if d.lower() not in exclude_folders]
        for filename in files:
            filepath = os.path.join(root, filename)
            # è·³è¿‡è¾“å‡ºæ–‡ä»¶æœ¬èº«
            if os.path.abspath(filepath) == os.path.abspath(output_file):
                continue
            try:
                with open(filepath, 'r', encoding='utf-8') as infile:
                    content = infile.read()
            except Exception as e:
                content = f"[æ— æ³•è¯»å–æ–‡ä»¶: {e}]"
            outfile.write(f"{filepath}ï¼š\nã€{content}ã€‘\n\n")
print(f"æ–‡ä»¶å†…å®¹å·²è¾“å‡ºåˆ° {output_file}")
ã€‘

.\WordPopupApp.csprojï¼š
ã€ï»¿<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>WinExe</OutputType>
    <TargetFramework>net9.0-windows</TargetFramework>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
    <UseWPF>true</UseWPF>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="CommunityToolkit.Mvvm" Version="8.4.0" />
    <PackageReference Include="ZiggyCreatures.FusionCache.Serialization.NewtonsoftJson" Version="2.3.0" />
    <FrameworkReference Include="Microsoft.WindowsDesktop.App.WindowsForms" />

  </ItemGroup>

</Project>
ã€‘

.\WordPopupApp.csproj.userï¼š
ã€ï»¿<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="Current" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup />
</Project>ã€‘

.\WordPopupApp.slnï¼š
ã€ï»¿
Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 17
VisualStudioVersion = 17.14.36212.18 d17.14
MinimumVisualStudioVersion = 10.0.40219.1
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "WordPopupApp", "WordPopupApp.csproj", "{447F9C31-11D4-4E59-80AC-FDC5D752943E}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|Any CPU = Debug|Any CPU
		Release|Any CPU = Release|Any CPU
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{447F9C31-11D4-4E59-80AC-FDC5D752943E}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
		{447F9C31-11D4-4E59-80AC-FDC5D752943E}.Debug|Any CPU.Build.0 = Debug|Any CPU
		{447F9C31-11D4-4E59-80AC-FDC5D752943E}.Release|Any CPU.ActiveCfg = Release|Any CPU
		{447F9C31-11D4-4E59-80AC-FDC5D752943E}.Release|Any CPU.Build.0 = Release|Any CPU
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {7E579AB8-3E00-4E43-BA72-7685CD9D41FC}
	EndGlobalSection
EndGlobal
ã€‘

.\Models\AnkiModels.csï¼š
ã€ï»¿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

using System.Collections.Generic;

namespace WordPopupApp.Models
{
    public class AnkiNote
    {
        public string DeckName { get; set; }
        public string ModelName { get; set; }
        public Dictionary<string, string> Fields { get; set; }
        public List<string> Tags { get; set; }
    }

    public class AnkiAction
    {
        public string Action { get; set; }
        public int Version { get; set; }
        public object Params { get; set; }
    }

    public class AnkiAddNoteAction : AnkiAction
    {
        public AnkiAddNoteAction(AnkiNote note)
        {
            Action = "addNote";
            Version = 6;
            Params = new { note };
        }
    }
}
ã€‘

.\Models\AppSettings.csï¼š
ã€namespace WordPopupApp.Models
{
    public class AppSettings
    {
        public string AnkiDeckName { get; set; } = "Default";
        public string AnkiModelName { get; set; } = "Basic";
    }
}ã€‘

.\Models\DictionaryModels.csï¼š
ã€ï»¿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

// æˆ‘ä»¬å°†ä½¿ç”¨å…è´¹çš„ https://dictionaryapi.dev/
// è¿™ä¸ªæ–‡ä»¶æ˜¯æ ¹æ®å…¶è¿”å›çš„JSONç»“æ„åˆ›å»ºçš„
using System.Collections.Generic;

namespace WordPopupApp.Models
{
    public class Phonetic
    {
        public string Text { get; set; }
        public string Audio { get; set; }
    }

    public class Definition
    {
        public string PartOfSpeech { get; set; }
        public List<string> Synonyms { get; set; }
        public List<string> Antonyms { get; set; }
        public string DefinitionText { get; set; } // Renamed from "definition"
        public string Example { get; set; }
    }

    public class Meaning
    {
        public string PartOfSpeech { get; set; }
        public List<Definition> Definitions { get; set; }
    }

    public class DictionaryEntry
    {
        public string Word { get; set; }
        public List<Phonetic> Phonetics { get; set; }
        public List<Meaning> Meanings { get; set; }
    }
}ã€‘

.\Services\AnkiService.csï¼š
ã€ï»¿
using WordPopupApp.Models;

namespace WordPopupApp.Services
{
    public class AnkiService
    {
        public async Task AddNoteAsync(AnkiNote note)
        {
            throw new NotImplementedException();
        }
    }
}
ã€‘

.\Services\DictionaryService.csï¼š
ã€ï»¿using Newtonsoft.Json;
using System.Collections.Generic;
using System.Linq;
using System.Net.Http;
using System.Threading.Tasks;
using WordPopupApp.Models;

namespace WordPopupApp.Services
{
    public class DictionaryService
    {
        private readonly HttpClient _httpClient = new HttpClient();
        private const string ApiUrl = "https://api.dictionaryapi.dev/api/v2/entries/en/";

        public async Task<DictionaryEntry> LookupAsync(string word)
        {
            try
            {
                var response = await _httpClient.GetAsync(ApiUrl + word);
                if (!response.IsSuccessStatusCode) return null;

                var json = await response.Content.ReadAsStringAsync();
                // APIè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬åªå–ç¬¬ä¸€ä¸ªç»“æœ
                var entries = JsonConvert.DeserializeObject<List<DictionaryEntry>>(json);
                return entries?.FirstOrDefault();
            }
            catch
            {
                return null;
            }
        }
    }
}ã€‘

.\Services\GlobalHotKey.csï¼š
ã€ï»¿// éœ€è¦å¼•ç”¨ System.Windows.Forms
using System;
using System.Runtime.InteropServices;
using System.Threading;
using System.Windows;
using System.Windows.Forms;
using System.Windows.Interop;
using Clipboard = System.Windows.Clipboard;

namespace WordPopupApp.Services
{
    public class GlobalHotKey : IDisposable
    {
        [DllImport("user32.dll")]
        private static extern bool RegisterHotKey(IntPtr hWnd, int id, uint fsModifiers, uint vk);

        [DllImport("user32.dll")]
        private static extern bool UnregisterHotKey(IntPtr hWnd, int id);

        // ä½¿ç”¨ SendKeys æ¨¡æ‹Ÿ Ctrl+C
        public static void SimulateCtrlC()
        {
            Thread.Sleep(100); // ç­‰å¾…ä¸€ä¸‹ï¼Œç¡®ä¿ç„¦ç‚¹åœ¨é€‰ä¸­çš„æ–‡æœ¬ä¸Š
            SendKeys.SendWait("^c");
            Thread.Sleep(100); // ç­‰å¾…å‰ªè´´æ¿å†…å®¹æ›´æ–°
        }

        public static string GetTextFromClipboard()
        {
            for (int i = 0; i < 5; i++) // å°è¯•å‡ æ¬¡ä»¥é˜²ä¸‡ä¸€
            {
                try
                {
                    if (Clipboard.ContainsText())
                    {
                        return Clipboard.GetText();
                    }
                }
                catch (COMException)
                {
                    // å‰ªè´´æ¿æ­£è¢«å…¶ä»–è¿›ç¨‹å ç”¨ï¼Œç¨ç­‰åé‡è¯•
                    Thread.Sleep(50);
                }
            }
            return string.Empty;
        }


        private HwndSource _source;
        private readonly int _id;
        private readonly Window _window;

        public event Action HotKeyPressed;

        public GlobalHotKey(Window window, uint modifier, uint key)
        {
            _window = window;
            _id = GetHashCode();

            var helper = new WindowInteropHelper(_window);
            helper.EnsureHandle();
            _source = HwndSource.FromHwnd(helper.Handle);
            _source.AddHook(HwndHook);

            if (!RegisterHotKey(_source.Handle, _id, modifier, key))
            {
                throw new InvalidOperationException("æ— æ³•æ³¨å†Œçƒ­é”®ã€‚");
            }
        }

        private IntPtr HwndHook(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled)
        {
            const int WM_HOTKEY = 0x0312;
            if (msg == WM_HOTKEY && wParam.ToInt32() == _id)
            {
                HotKeyPressed?.Invoke();
                handled = true;
            }
            return IntPtr.Zero;
        }

        public void Dispose()
        {
            _source.RemoveHook(HwndHook);
            UnregisterHotKey(_source.Handle, _id);
        }
    }

    // å®šä¹‰ä¿®é¥°é”®å¸¸é‡
    public static class HotKeyModifiers
    {
        public const uint MOD_NONE = 0x0000;
        public const uint MOD_ALT = 0x0001;
        public const uint MOD_CONTROL = 0x0002;
        public const uint MOD_SHIFT = 0x0004;
        public const uint MOD_WIN = 0x0008;
    }
}ã€‘

.\Services\SettingsService.csï¼š
ã€ï»¿using Newtonsoft.Json;
using System;
using System.IO;
using WordPopupApp.Models;

namespace WordPopupApp.Services
{
    public class SettingsService
    {
        private readonly string _settingsFilePath;

        public SettingsService()
        {
            // å°†é…ç½®æ–‡ä»¶ä¿å­˜åœ¨ AppData ç›®å½•ä¸‹
            string appDataPath = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
            string appDir = Path.Combine(appDataPath, "WordPopupApp");
            Directory.CreateDirectory(appDir);
            _settingsFilePath = Path.Combine(appDir, "settings.json");
        }

        public AppSettings LoadSettings()
        {
            if (File.Exists(_settingsFilePath))
            {
                var json = File.ReadAllText(_settingsFilePath);
                return JsonConvert.DeserializeObject<AppSettings>(json);
            }
            return new AppSettings(); // è¿”å›é»˜è®¤è®¾ç½®
        }

        public void SaveSettings(AppSettings settings)
        {
            var json = JsonConvert.SerializeObject(settings, Formatting.Indented);
            File.WriteAllText(_settingsFilePath, json);
        }
    }
}ã€‘

.\ViewModels\PopupResultViewModel.csï¼š
ã€ï»¿using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Controls;
using WordPopupApp.Services;
using WordPopupApp.Models;
using WordPopupApp.Services;

namespace WordPopupApp.ViewModels
{
    public partial class PopupResultViewModel : ObservableObject
    {
        [ObservableProperty]
        private bool isLoading = true;

        [ObservableProperty]
        private string word;

        [ObservableProperty]
        private string phoneticText;

        [ObservableProperty]
        private string definitionText;

        [ObservableProperty]
        private bool hasAudio;

        private string audioUrl;
        private DictionaryEntry _fullEntry;
        private readonly AnkiService _ankiService;
        private readonly AppSettings _settings;

        public PopupResultViewModel(DictionaryEntry entry, AnkiService ankiService, AppSettings settings)
        {
            _fullEntry = entry;
            _ankiService = ankiService;
            _settings = settings;   

            IsLoading = false;

            if (entry == null)
            {
                Word = "æœªæ‰¾åˆ°";
                DefinitionText = "æ— æ³•æŸ¥è¯¢åˆ°è¯¥å•è¯æˆ–çŸ­è¯­çš„é‡Šä¹‰ã€‚";
                return;
            }

            Word = entry.Word;

            var phonetic = entry.Phonetics?.FirstOrDefault(p => !string.IsNullOrEmpty(p.Text));
            PhoneticText = phonetic?.Text ?? "";

            var audio = entry.Phonetics?.FirstOrDefault(p => !string.IsNullOrEmpty(p.Audio));
            audioUrl = audio?.Audio;
            HasAudio = !string.IsNullOrEmpty(audioUrl);

            var sb = new StringBuilder();
            foreach (var meaning in entry.Meanings)
            {
                sb.AppendLine($"â–¶ {meaning.PartOfSpeech}");
                foreach (var def in meaning.Definitions.Take(3)) // æœ€å¤šæ˜¾ç¤º3æ¡é‡Šä¹‰
                {
                    sb.AppendLine($"  - {def.DefinitionText}");
                    if (!string.IsNullOrEmpty(def.Example))
                    {
                        sb.AppendLine($"    e.g. {def.Example}");
                    }
                }
                sb.AppendLine();
            }
            DefinitionText = sb.ToString().Trim();
        }

        [RelayCommand]
        private void PlayAudio()
        {
            if (HasAudio)
            {
                // ä½¿ç”¨ä¸€ä¸ªä¸´æ—¶çš„ MediaElement æ’­æ”¾éŸ³é¢‘
                var mediaElement = new MediaElement { Volume = 1 };
                mediaElement.LoadedBehavior = MediaState.Play;
                mediaElement.Source = new System.Uri(audioUrl, System.UriKind.Absolute);
            }
        }

        [RelayCommand]
        private async Task AddToAnki()
        {
            if (_fullEntry == null) return;

            var note = new AnkiNote
            {
                DeckName = _settings.AnkiDeckName,
                ModelName = _settings.AnkiModelName,
                Fields = new System.Collections.Generic.Dictionary<string, string>
                {
                    // å‡è®¾ä½ çš„Ankiæ¨¡æ¿å­—æ®µæ˜¯ "Front" å’Œ "Back"
                    { "Front", Word },
                    { "Back", DefinitionText.Replace("\n", "<br/>") } // Ankiä¸­æ¢è¡Œç”¨<br/>
                },
                Tags = new System.Collections.Generic.List<string> { "WordPopupApp" }
            };

            await _ankiService.AddNoteAsync(note);
        }
    }
}ã€‘

.\Views\PopupResultWindow.xamlï¼š
ã€ï»¿<Window x:Class="WordPopupApp.Views.PopupResultWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WordPopupApp.Views"
        mc:Ignorable="d"
        Title="æŸ¥è¯¢ç»“æœ" Height="250" Width="400"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        ShowInTaskbar="False" Topmost="True" ResizeMode="NoResize"
        Deactivated="Window_Deactivated" MouseLeave="Window_MouseLeave"
        FontFamily="Microsoft YaHei UI">
    <Border Background="#F0FFFFFF" CornerRadius="8" BorderThickness="1" BorderBrush="#CCCCCC">
        <Border.Effect>
            <DropShadowEffect ShadowDepth="0" BlurRadius="10" Color="#AAAAAA" Opacity="0.5"/>
        </Border.Effect>
        <Grid Margin="15">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="{Binding Word}" FontSize="24" FontWeight="Bold" Foreground="#222222"/>
                <TextBlock Text="{Binding PhoneticText}" FontSize="16" VerticalAlignment="Center" Margin="10,0,0,0" Foreground="#555555"/>
            </StackPanel>

            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,5,0,10">
                <Button Content="ğŸ”Š UK" Command="{Binding PlayAudioCommand}" IsEnabled="{Binding HasAudio}" Margin="0,0,5,0" Padding="5,2"/>
            </StackPanel>

            <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                <TextBlock Text="{Binding DefinitionText}" TextWrapping="Wrap" FontSize="14" Foreground="#333333"/>
            </ScrollViewer>

            <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                <Button Content="+ Anki" Padding="10,3" Command="{Binding AddToAnkiCommand}"/>
            </StackPanel>

            <TextBlock Text="æ­£åœ¨æŸ¥è¯¢..." Grid.Row="0" Grid.RowSpan="4" FontSize="18"
                       HorizontalAlignment="Center" VerticalAlignment="Center"
                       Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"/>

        </Grid>
    </Border>
</Window>ã€‘

.\Views\PopupResultWindow.xaml.csï¼š
ã€ï»¿using System.Runtime.InteropServices;
using System.Windows;
using System.Windows.Input;

namespace WordPopupApp.Views
{
    public partial class PopupResultWindow : Window
    {
        // P/Invoke for getting mouse position
        [DllImport("user32.dll")]
        [return: MarshalAs(UnmanagedType.Bool)]
        internal static extern bool GetCursorPos(ref Win32Point pt);

        [StructLayout(LayoutKind.Sequential)]
        internal struct Win32Point
        {
            public int X;
            public int Y;
        };

        public static Point GetMousePosition()
        {
            var w32Mouse = new Win32Point();
            GetCursorPos(ref w32Mouse);
            return new Point(w32Mouse.X, w32Mouse.Y);
        }

        public PopupResultWindow()
        {
            InitializeComponent();
        }

        public void SetPositionAndShow()
        {
            var mousePosition = GetMousePosition();
            this.Left = mousePosition.X + 15; // åœ¨é¼ æ ‡å³ä¾§æ˜¾ç¤º
            this.Top = mousePosition.Y + 15;  // åœ¨é¼ æ ‡ä¸‹æ–¹æ˜¾ç¤º

            // ç¡®ä¿çª—å£ä¸ä¼šè¶…å‡ºå±å¹•è¾¹ç•Œ
            ValidatePosition();

            this.Show();
            this.Activate();
        }

        private void ValidatePosition()
        {
            double screenWidth = SystemParameters.VirtualScreenWidth;
            double screenHeight = SystemParameters.VirtualScreenHeight;

            if (this.Left + this.Width > screenWidth)
            {
                this.Left = screenWidth - this.Width - 15;
            }
            if (this.Top + this.Height > screenHeight)
            {
                this.Top = screenHeight - this.Height - 15;
            }
        }


        // çª—å£å¤±å»ç„¦ç‚¹æ—¶è‡ªåŠ¨å…³é—­
        private void Window_Deactivated(object sender, System.EventArgs e)
        {
            this.Close();
        }

        // é¼ æ ‡ç¦»å¼€çª—å£æ—¶è‡ªåŠ¨å…³é—­ï¼ˆæä¾›å¤šä¸€ç§å…³é—­æ–¹å¼ï¼‰
        private void Window_MouseLeave(object sender, MouseEventArgs e)
        {
            this.Close();
        }
    }
}ã€‘

